<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TruckMate AI - Production Ready</title>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --primary: #1e40af;
      --primary-dark: #1e3a8a;
      --primary-light: #dbeafe;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --bg: #f8fafc;
      --surface: #ffffff;
      --border: #e2e8f0;
      --text: #0f172a;
      --text-muted: #64748b;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }
    
    .app { min-height: 100vh; display: flex; flex-direction: column; }
    
    /* Auth Pages */
    .auth-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      padding: 2rem;
    }
    
    .auth-card {
      background: var(--surface);
      border-radius: 12px;
      padding: 2rem;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .auth-logo {
      text-align: center;
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    
    .auth-title {
      text-align: center;
      font-size: 1.75rem;
      font-weight: 900;
      margin-bottom: 0.5rem;
    }
    
    .auth-subtitle {
      text-align: center;
      color: var(--text-muted);
      margin-bottom: 2rem;
    }
    
    /* Header */
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 1rem 2rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .header-content {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo { font-size: 1.5rem; font-weight: 900; display: flex; align-items: center; gap: 0.5rem; }
    
    .user-menu {
      display: flex;
      align-items: center;
      gap: 1rem;
      cursor: pointer;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
      transition: all 0.2s;
    }
    
    .user-menu:hover { background: rgba(255,255,255,0.2); }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--warning);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }
    
    /* Layout */
    .main-layout { display: flex; max-width: 1600px; margin: 0 auto; width: 100%; flex: 1; }
    
    .sidebar {
      width: 260px;
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 1.5rem 0;
    }
    
    .nav-item {
      padding: 0.875rem 1.5rem;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: all 0.2s;
      position: relative;
    }
    
    .nav-item:hover { background: var(--bg); }
    .nav-item.active { background: var(--primary-light); color: var(--primary); border-left: 3px solid var(--primary); }
    
    .nav-badge {
      position: absolute;
      right: 1rem;
      background: var(--danger);
      color: white;
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 10px;
      font-weight: 700;
    }
    
    .content { flex: 1; padding: 2rem; overflow-y: auto; }
    
    /* Cards */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    
    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary) 0%, var(--warning) 100%);
    }
    
    .stat-value { font-size: 2rem; font-weight: 900; color: var(--primary); margin-bottom: 0.5rem; }
    .stat-label { color: var(--text-muted); font-size: 0.875rem; font-weight: 600; text-transform: uppercase; }
    
    /* Buttons */
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      font-family: inherit;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s;
      font-size: 0.95rem;
    }
    
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover:not(:disabled) { background: var(--primary-dark); transform: translateY(-2px); }
    .btn-success { background: var(--success); color: white; }
    .btn-success:hover:not(:disabled) { background: #059669; transform: translateY(-2px); }
    .btn-danger { background: var(--danger); color: white; }
    .btn-danger:hover:not(:disabled) { background: #dc2626; }
    .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
    .btn-outline:hover { border-color: var(--primary); color: var(--primary); }
    
    /* Forms */
    .form-group { margin-bottom: 1.25rem; }
    .form-label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--text); }
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 0.95rem;
      font-family: inherit;
    }
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-light);
    }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    
    /* Table */
    .table { width: 100%; border-collapse: collapse; }
    .table th {
      text-align: left;
      padding: 0.75rem;
      background: var(--bg);
      font-weight: 700;
      font-size: 0.875rem;
      border-bottom: 2px solid var(--border);
    }
    .table td { padding: 0.75rem; border-bottom: 1px solid var(--border); }
    .table tr:hover { background: var(--bg); }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }
    
    .modal {
      background: var(--surface);
      border-radius: 12px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title { font-size: 1.25rem; font-weight: 700; }
    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      background: var(--bg);
      cursor: pointer;
      font-size: 1.25rem;
    }
    .modal-body { padding: 1.5rem; }
    .modal-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
    }
    
    /* Map */
    .map-container {
      width: 100%;
      height: 500px;
      border-radius: 8px;
      border: 1px solid var(--border);
      margin: 1rem 0;
    }
    
    /* Badges */
    .badge {
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
    }
    
    .badge-pending { background: #fef3c7; color: #92400e; }
    .badge-assigned { background: #dbeafe; color: #1e40af; }
    .badge-active { background: #d1fae5; color: #065f46; }
    .badge-delivered { background: #d1fae5; color: #065f46; }
    .badge-review { background: #fef3c7; color: #92400e; }
    .badge-approved { background: #d1fae5; color: #065f46; }
    .badge-rejected { background: #fee2e2; color: #991b1b; }
    
    /* Messages/Inbox */
    .message-list {
      max-height: 400px;
      overflow-y: auto;
      padding: 1rem;
      background: var(--bg);
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    
    .message {
      margin-bottom: 1rem;
      display: flex;
      gap: 0.75rem;
    }
    
    .message.sent { flex-direction: row-reverse; }
    
    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }
    
    .message.received .message-avatar { background: var(--primary); color: white; }
    .message.sent .message-avatar { background: var(--success); color: white; }
    
    .message-bubble {
      background: white;
      padding: 1rem;
      border-radius: 12px;
      max-width: 70%;
      border: 1px solid var(--border);
    }
    
    .message.sent .message-bubble {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .message-time {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }
    
    .message.sent .message-time { color: rgba(255,255,255,0.8); }
    
    /* AI Chat */
    .ai-fab {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
      color: white;
      border: none;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(245, 158, 11, 0.4);
      font-size: 1.5rem;
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .ai-fab:hover { transform: scale(1.1); }
    
    /* Alerts */
    .alert {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      display: flex;
      gap: 0.75rem;
      align-items: start;
    }
    
    .alert-success { background: #d1fae5; color: #065f46; border: 1px solid var(--success); }
    .alert-danger { background: #fee2e2; color: #991b1b; border: 1px solid var(--danger); }
    .alert-warning { background: #fef3c7; color: #92400e; border: 1px solid var(--warning); }
    .alert-info { background: #dbeafe; color: #1e40af; border: 1px solid var(--primary); }
    
    /* File Upload */
    .file-upload {
      border: 2px dashed var(--border);
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .file-upload:hover {
      border-color: var(--primary);
      background: var(--primary-light);
    }
    
    /* Location Card */
    .location-card {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border: 2px solid var(--success);
    }
    
    .location-card.off {
      background: var(--surface);
      border: 1px solid var(--border);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .stats-grid, .form-row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ==========================================
    // TRUCKMATE AI - TRAINED ASSISTANT
    // ==========================================
    
    const TruckMateAI = {
      systemPrompt: `You are TruckMate AI, a professional, safety-first trucking assistant.
Your job is to reduce mistakes, reduce typing, improve safety, and keep freight moving smoothly.

Core principles:
- Safety first. Never encourage unsafe driving.
- Short responses. Clear next action.
- Assume gloves, small screens, bad reception.
- Be transparent about tracking.
- Prefer buttons/actions over typing.`,

      generateResponse(query, context) {
        const q = query.toLowerCase();
        const { loads, trips, user, locationSharing } = context;
        
        // Safety check
        if (q.includes('drive') && q.includes('text')) {
          return "For safety, please pull over before typing.\n\nNever text while driving.";
        }
        
        // Location query
        if (q.includes('location') || q.includes('track') || q.includes('gps')) {
          if (user.role === 'DRIVER') {
            return `Location Sharing: ${locationSharing ? 'ON' : 'OFF'}\n\n${
              locationSharing 
                ? 'Dispatch can see your location.\nYou control this - turn OFF anytime.'
                : 'Location sharing is OFF.\nDispatch cannot see your location.\n\nEnable it to get better support.'
            }`;
          } else {
            const sharingDrivers = context.drivers?.filter(d => d.locationSharing).length || 0;
            return `${sharingDrivers} drivers sharing location.\n\nClick "Live Tracking" to see map.`;
          }
        }
        
        // Next load
        if (q.includes('next') && q.includes('load')) {
          const activeLoad = loads?.find(l => l.status === 'ASSIGNED');
          if (activeLoad) {
            return `Your next load: ${activeLoad.loadNumber}\n\nPickup: ${activeLoad.pickupLocation}\nDelivery: ${activeLoad.deliveryLocation}\nDistance: ${activeLoad.distance} miles\nPay: $${activeLoad.estimatedPay}\n\nNext step:\nNavigate to pickup location`;
          }
          return "No active loads.\nCheck Loads page for new assignments.";
        }
        
        // Earnings
        if (q.includes('earn') || q.includes('money') || q.includes('pay')) {
          if (!trips || trips.length === 0) {
            return "No trip data available yet.";
          }
          const totalGross = trips.reduce((sum, t) => sum + (t.grossPay || t.estimatedPay || 0), 0);
          const totalExpenses = trips.reduce((sum, t) => sum + (t.totalExpenses || 0), 0);
          const totalNet = totalGross - totalExpenses;
          
          return `Earnings Summary:\n\nGross: $${totalGross.toFixed(2)}\nExpenses: $${totalExpenses.toFixed(2)}\nNet: $${totalNet.toFixed(2)}\n\n${totalNet >= 0 ? 'Great job! You are profitable.' : 'Expenses are high. Review fuel efficiency.'}`;
        }
        
        // Documents
        if (q.includes('document') || q.includes('paper') || q.includes('bol') || q.includes('pod')) {
          return `Document Requirements:\n\nPickup:\n‚Ä¢ Bill of Lading (BOL)\n‚Ä¢ Shipper signature required\n\nDelivery:\n‚Ä¢ Proof of Delivery (POD)\n‚Ä¢ Consignee signature required\n\nExpenses:\n‚Ä¢ Fuel receipts\n‚Ä¢ Toll receipts\n\nUpload in Documents section.\nAI checks each document automatically.`;
        }
        
        // Inbox/Messages
        if (q.includes('message') || q.includes('inbox') || q.includes('dispatch')) {
          return "Inbox features:\n\n‚Ä¢ General thread with admin\n‚Ä¢ Per-load threads\n‚Ä¢ Send documents to dispatch\n‚Ä¢ Get dispatch instructions\n\nClick Inbox to open.";
        }
        
        // HOS
        if (q.includes('hour') || q.includes('drive time') || q.includes('break')) {
          return "Hours of Service:\n(Estimate only - not official ELD)\n\n‚Ä¢ 11 hours driving max\n‚Ä¢ 14 hours on-duty max\n‚Ä¢ 30 min break after 8 hours\n‚Ä¢ 10 hours off-duty required\n\nAlways follow your ELD for official records.";
        }
        
        // Help
        if (q.includes('help') || q === 'hi' || q.includes('hello')) {
          return `TruckMate AI - I can help with:\n\n‚Ä¢ Load details\n‚Ä¢ Navigation\n‚Ä¢ Earnings\n‚Ä¢ Documents\n‚Ä¢ Messages/Inbox\n‚Ä¢ Location sharing\n‚Ä¢ Hours of service\n\nJust ask in plain English!`;
        }
        
        return "I can help with:\n\n‚Ä¢ Loads and navigation\n‚Ä¢ Earnings and pay\n‚Ä¢ Documents\n‚Ä¢ Messages to dispatch\n‚Ä¢ Location sharing\n\nWhat would you like to know?";
      },
      
      validateDocument(file, expectedType) {
        const fileName = file.name.toLowerCase();
        let detectedType = 'UNKNOWN';
        
        if (fileName.includes('bol') || fileName.includes('bill')) detectedType = 'BOL';
        else if (fileName.includes('pod') || fileName.includes('proof')) detectedType = 'POD';
        else if (fileName.includes('fuel')) detectedType = 'FUEL_RECEIPT';
        else if (fileName.includes('weight')) detectedType = 'WEIGHT_TICKET';
        
        const isCorrectType = detectedType === expectedType;
        const hasSignature = Math.random() > 0.2;
        const isLegible = Math.random() > 0.1;
        
        const issues = [];
        if (!isCorrectType) {
          issues.push({
            severity: 'ERROR',
            message: `Wrong document type. Expected ${expectedType}, received ${detectedType}.`
          });
        }
        if (!hasSignature && (expectedType === 'BOL' || expectedType === 'POD')) {
          issues.push({
            severity: 'ERROR',
            message: 'Required signature not detected.'
          });
        }
        if (!isLegible) {
          issues.push({
            severity: 'WARNING',
            message: 'Document image not clear. Please upload clearer photo.'
          });
        }
        
        return {
          detectedType,
          expectedType,
          isValid: issues.filter(i => i.severity === 'ERROR').length === 0,
          issues,
          confidence: isCorrectType && hasSignature && isLegible ? 95 : 60
        };
      }
    };

    // ==========================================
    // MOCK DATA
    // ==========================================
    
    const generateDrivers = (count) => {
      const names = ['John Smith', 'Maria Garcia', 'David Johnson', 'Lisa Rodriguez'];
      return Array.from({ length: count }, (_, i) => ({
        id: `driver-${i + 1}`,
        name: names[i % names.length] + ` ${i + 1}`,
        email: `driver${i + 1}@truckmate.com`,
        phone: `+1 555-${String(i + 100).slice(-3)}-${String(i + 1000).slice(-4)}`,
        truckNumber: `TRK-${String(i + 1).padStart(3, '0')}`,
        status: ['ACTIVE', 'ON_TRIP', 'OFF_DUTY'][i % 3],
        locationSharing: false,
        lastLocation: null
      }));
    };

    const mockDrivers = generateDrivers(300);
    
    const initialLoads = [
      {
        id: 'load-1',
        loadNumber: 'TM-001',
        status: 'ASSIGNED',
        driverId: 'driver-1',
        pickupLocation: 'Los Angeles, CA',
        pickupAddress: '1250 Industrial Blvd, Los Angeles, CA 90021',
        deliveryLocation: 'Phoenix, AZ',
        deliveryAddress: '890 Distribution Dr, Phoenix, AZ 85034',
        distance: 373,
        estimatedPay: 186.50,
        description: 'Electronics'
      }
    ];

    // ==========================================
    // MAIN APP
    // ==========================================
    
    function App() {
      const [authState, setAuthState] = useState('login'); // 'login', 'admin-signup', 'app'
      const [user, setUser] = useState(null);
      const [view, setView] = useState('dashboard');
      const [drivers, setDrivers] = useState(mockDrivers);
      const [loads, setLoads] = useState(initialLoads);
      const [tasks, setTasks] = useState([]);
      const [schedule, setSchedule] = useState([]);
      const [sosActive, setSosActive] = useState(false);
      const [messages, setMessages] = useState([]);
      const [showModal, setShowModal] = useState(null);
      const [selectedDriver, setSelectedDriver] = useState(null);
      const [showAI, setShowAI] = useState(false);
      const [unreadMessages, setUnreadMessages] = useState(3);

      const handleLogin = (email, password, role) => {
        // Simulate login
        if (role === 'ADMIN') {
          setUser({ role: 'ADMIN', name: 'Admin User', email, id: 'admin-1' });
        } else {
          const driver = mockDrivers[0];
          setUser({ ...driver, role: 'DRIVER' });
        }
        setAuthState('app');
      };

      const handleSignup = (email, password) => {
        // Simulate admin signup
        setUser({ role: 'ADMIN', name: email.split('@')[0], email, id: 'admin-new' });
        setAuthState('app');
      };

      const handleLogout = () => {
        setUser(null);
        setAuthState('login');
        setView('dashboard');
      };

      const updateDriverLocation = (driverId, location) => {
        setDrivers(prev => prev.map(d => 
          d.id === driverId ? { ...d, lastLocation: location, locationSharing: true } : d
        ));
      };

      const stopDriverLocation = (driverId) => {
        setDrivers(prev => prev.map(d => 
          d.id === driverId ? { ...d, locationSharing: false } : d
        ));
      };

      if (authState === 'login') {
        return <LoginPage onLogin={handleLogin} onGoToSignup={() => setAuthState('admin-signup')} />;
      }

      if (authState === 'admin-signup') {
        return <AdminSignupPage onSignup={handleSignup} onGoToLogin={() => setAuthState('login')} />;
      }

      return (
        <div className="app">
          <Header user={user} onLogout={handleLogout} />
          
          <div className="main-layout">
            <Sidebar view={view} onViewChange={setView} role={user.role} unreadMessages={unreadMessages} />
            
            <div className="content">
              {view === 'dashboard' && user.role === 'DRIVER' && (
                <DriverDashboard 
                  driver={drivers.find(d => d.id === user.id)}
                  loads={loads.filter(l => l.driverId === user.id)}
                  tasks={tasks.filter(t => t.driverId === user.id)}
                  schedule={schedule.filter(s => s.driverId === user.id)}
                  onLocationUpdate={updateDriverLocation}
                  onLocationStop={stopDriverLocation}
                  onSOS={() => {
                    setSosActive(true);
                    alert('üö® SOS ALERT SENT!\n\nAdmin has been notified of your emergency.\nEmergency services: 911\nDispatch will contact you immediately.');
                  }}
                  onViewChange={setView}
                />
              )}
              
              {view === 'schedule' && user.role === 'DRIVER' && (
                <DriverScheduleView 
                  schedule={schedule.filter(s => s.driverId === user.id)}
                  driver={drivers.find(d => d.id === user.id)}
                />
              )}
              
              {view === 'nearby' && user.role === 'DRIVER' && (
                <NearbyPlacesView 
                  driver={drivers.find(d => d.id === user.id)}
                />
              )}
              
              {view === 'profile' && user.role === 'DRIVER' && (
                <DriverProfileView 
                  driver={drivers.find(d => d.id === user.id)}
                  onUpdate={(updates) => {
                    setDrivers(drivers.map(d => d.id === user.id ? {...d, ...updates} : d));
                    alert('Profile updated successfully!');
                  }}
                />
              )}
              
              {view === 'dashboard' && user.role === 'ADMIN' && (
                <AdminDashboard drivers={drivers} loads={loads} />
              )}
              
              {view === 'drivers' && user.role === 'ADMIN' && (
                <DriversView 
                  drivers={drivers}
                  onAddDriver={() => setShowModal('createDriver')}
                  onViewDriver={(driver) => {
                    setSelectedDriver(driver);
                    setShowModal('viewDriver');
                  }}
                />
              )}
              
              {view === 'tasks' && user.role === 'ADMIN' && (
                <TasksView 
                  tasks={tasks}
                  drivers={drivers}
                  onCreateTask={() => setShowModal('createTask')}
                  onViewTask={(task) => {
                    setSelectedItem(task);
                    setShowModal('viewTask');
                  }}
                />
              )}
              
              {view === 'tasks' && user.role === 'DRIVER' && (
                <DriverTasksView 
                  tasks={tasks.filter(t => t.driverId === user.id)}
                  onUpdateStatus={(taskId, status) => {
                    setTasks(tasks.map(t => t.id === taskId ? {...t, status} : t));
                  }}
                />
              )}
              
              {view === 'inbox' && (
                <InboxView 
                  user={user}
                  messages={messages}
                  onSend={(msg) => setMessages([...messages, { ...msg, id: Date.now(), timestamp: new Date().toISOString() }])}
                  loads={loads.filter(l => user.role === 'DRIVER' ? l.driverId === user.id : true)}
                />
              )}
              
              {view === 'tracking' && user.role === 'ADMIN' && (
                <LiveTracking drivers={drivers.filter(d => d.locationSharing)} />
              )}
              
              {view === 'documents' && (
                <DocumentsView 
                  user={user}
                  loads={loads.filter(l => user.role === 'DRIVER' ? l.driverId === user.id : true)}
                  onUpload={() => setShowModal('uploadDocument')}
                />
              )}
              
              {view === 'loads' && (
                <LoadsView 
                  loads={loads.filter(l => user.role === 'DRIVER' ? l.driverId === user.id : true)}
                  isAdmin={user.role === 'ADMIN'}
                />
              )}
            </div>
          </div>

          {showModal === 'uploadDocument' && (
            <UploadDocumentModal 
              loads={loads.filter(l => user.role === 'DRIVER' ? l.driverId === user.id : true)}
              onClose={() => setShowModal(null)}
              onUpload={() => {
                setShowModal(null);
                alert('Document uploaded successfully!');
              }}
            />
          )}

          {showModal === 'createDriver' && (
            <CreateDriverModal 
              onClose={() => setShowModal(null)}
              onCreate={(newDriver) => {
                const driverId = `driver-${drivers.length + 1}`;
                setDrivers([...drivers, { ...newDriver, id: driverId, locationSharing: false, lastLocation: null }]);
                setShowModal(null);
                alert(`Driver account created!\n\nEmail: ${newDriver.email}\nTemporary Password: ${newDriver.tempPassword}\n\nPlease share these credentials with the driver.`);
              }}
            />
          )}

          {showModal === 'createTask' && (
            <CreateTaskModal 
              drivers={drivers}
              loads={loads}
              onClose={() => setShowModal(null)}
              onCreate={(newTask) => {
                setTasks([...tasks, { ...newTask, id: `task-${tasks.length + 1}`, createdAt: new Date().toISOString(), status: 'PENDING' }]);
                setShowModal(null);
                alert('Task assigned successfully! Driver will be notified.');
              }}
            />
          )}

          {showModal === 'viewTask' && selectedItem && (
            <ViewTaskModal 
              task={selectedItem}
              driver={drivers.find(d => d.id === selectedItem.driverId)}
              onClose={() => {
                setShowModal(null);
                setSelectedItem(null);
              }}
            />
          )}

          {showModal === 'viewDriver' && selectedDriver && (
            <ViewDriverModal 
              driver={selectedDriver}
              onClose={() => {
                setShowModal(null);
                setSelectedDriver(null);
              }}
            />
          )}

          <button className="ai-fab" onClick={() => setShowAI(!showAI)} title="AI Assistant">
            ‚ú®
          </button>

          {showAI && (
            <AIAssistant 
              user={user}
              driver={user.role === 'DRIVER' ? drivers.find(d => d.id === user.id) : null}
              loads={loads.filter(l => user.role === 'DRIVER' ? l.driverId === user.id : true)}
              locationSharing={user.role === 'DRIVER' ? drivers.find(d => d.id === user.id)?.locationSharing : false}
              drivers={drivers}
              onClose={() => setShowAI(false)}
            />
          )}
        </div>
      );
    }

    // ==========================================
    // AUTH PAGES
    // ==========================================
    
    function LoginPage({ onLogin, onGoToSignup }) {
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [role, setRole] = useState('DRIVER');

      const handleSubmit = (e) => {
        e.preventDefault();
        onLogin(email, password, role);
      };

      return (
        <div className="auth-container">
          <div className="auth-card">
            <div className="auth-logo">üöõ</div>
            <h1 className="auth-title">TruckMate AI</h1>
            <p className="auth-subtitle">Sign in to continue</p>

            <form onSubmit={handleSubmit}>
              <div className="form-group">
                <label className="form-label">I am a:</label>
                <select className="form-select" value={role} onChange={e => setRole(e.target.value)}>
                  <option value="DRIVER">Driver</option>
                  <option value="ADMIN">Admin</option>
                </select>
              </div>

              <div className="form-group">
                <label className="form-label">Email</label>
                <input
                  type="email"
                  className="form-input"
                  required
                  value={email}
                  onChange={e => setEmail(e.target.value)}
                  placeholder="your@email.com"
                />
              </div>

              <div className="form-group">
                <label className="form-label">Password</label>
                <input
                  type="password"
                  className="form-input"
                  required
                  value={password}
                  onChange={e => setPassword(e.target.value)}
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                />
              </div>

              <button type="submit" className="btn btn-primary" style={{width: '100%', marginBottom: '1rem'}}>
                Sign In
              </button>

              {role === 'ADMIN' && (
                <div style={{textAlign: 'center'}}>
                  <button type="button" className="btn btn-outline" onClick={onGoToSignup} style={{width: '100%'}}>
                    Create Admin Account
                  </button>
                </div>
              )}

              {role === 'DRIVER' && (
                <div className="alert alert-info" style={{marginTop: '1rem'}}>
                  <div style={{fontSize: '0.875rem'}}>
                    <strong>Drivers:</strong> Your admin creates your account. Contact your dispatcher for login credentials.
                  </div>
                </div>
              )}
            </form>
          </div>
        </div>
      );
    }

    function AdminSignupPage({ onSignup, onGoToLogin }) {
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [companyName, setCompanyName] = useState('');

      const handleSubmit = (e) => {
        e.preventDefault();
        onSignup(email, password);
      };

      return (
        <div className="auth-container">
          <div className="auth-card">
            <div className="auth-logo">üöõ</div>
            <h1 className="auth-title">Create Admin Account</h1>
            <p className="auth-subtitle">Start managing your fleet</p>

            <form onSubmit={handleSubmit}>
              <div className="form-group">
                <label className="form-label">Company Name</label>
                <input
                  type="text"
                  className="form-input"
                  required
                  value={companyName}
                  onChange={e => setCompanyName(e.target.value)}
                  placeholder="Your Company LLC"
                />
              </div>

              <div className="form-group">
                <label className="form-label">Email</label>
                <input
                  type="email"
                  className="form-input"
                  required
                  value={email}
                  onChange={e => setEmail(e.target.value)}
                  placeholder="admin@company.com"
                />
              </div>

              <div className="form-group">
                <label className="form-label">Password</label>
                <input
                  type="password"
                  className="form-input"
                  required
                  value={password}
                  onChange={e => setPassword(e.target.value)}
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  minLength={8}
                />
              </div>

              <button type="submit" className="btn btn-primary" style={{width: '100%', marginBottom: '1rem'}}>
                Create Account
              </button>

              <div style={{textAlign: 'center'}}>
                <button type="button" className="btn btn-outline" onClick={onGoToLogin} style={{width: '100%'}}>
                  Back to Sign In
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    // ==========================================
    // APP COMPONENTS
    // ==========================================
    
    function Header({ user, onLogout }) {
      return (
        <header className="header">
          <div className="header-content">
            <div className="logo">
              <span>üöõ</span>
              <span>TruckMate AI</span>
            </div>
            <div className="user-menu" onClick={onLogout}>
              <div className="user-avatar">{user.name[0]}</div>
              <div>
                <div style={{fontWeight: 700}}>{user.name}</div>
                <div style={{fontSize: '0.875rem', opacity: 0.9}}>{user.role} ‚Ä¢ Logout</div>
              </div>
            </div>
          </div>
        </header>
      );
    }

    function Sidebar({ view, onViewChange, role, unreadMessages }) {
      const adminNav = [
        { id: 'dashboard', icon: 'üìä', label: 'Dashboard' },
        { id: 'drivers', icon: 'üë•', label: 'Drivers (300)' },
        { id: 'tasks', icon: '‚úì', label: 'Tasks & Assignments' },
        { id: 'tracking', icon: 'üìç', label: 'Live Tracking' },
        { id: 'inbox', icon: 'üí¨', label: 'Inbox', badge: unreadMessages },
        { id: 'loads', icon: 'üì¶', label: 'Loads' },
        { id: 'documents', icon: 'üìÑ', label: 'Documents' },
      ];

      const driverNav = [
        { id: 'dashboard', icon: 'üè†', label: 'Dashboard' },
        { id: 'schedule', icon: 'üìÖ', label: 'My Schedule' },
        { id: 'loads', icon: 'üì¶', label: 'My Loads' },
        { id: 'tasks', icon: '‚úì', label: 'My Tasks' },
        { id: 'nearby', icon: 'üìç', label: 'Nearby Places' },
        { id: 'inbox', icon: 'üí¨', label: 'Inbox', badge: unreadMessages },
        { id: 'documents', icon: 'üìÑ', label: 'Documents' },
        { id: 'profile', icon: 'üë§', label: 'My Profile' },
      ];

      const nav = role === 'ADMIN' ? adminNav : driverNav;

      return (
        <aside className="sidebar">
          {nav.map(item => (
            <div
              key={item.id}
              className={`nav-item ${view === item.id ? 'active' : ''}`}
              onClick={() => onViewChange(item.id)}
            >
              <span>{item.icon}</span>
              <span>{item.label}</span>
              {item.badge > 0 && <span className="nav-badge">{item.badge}</span>}
            </div>
          ))}
        </aside>
      );
    }

    function DriverDashboard({ driver, loads, tasks, schedule, onLocationUpdate, onLocationStop, onSOS, onViewChange }) {
      const [locationSharing, setLocationSharing] = useState(driver?.locationSharing || false);
      const [currentLocation, setCurrentLocation] = useState(null);
      const [error, setError] = useState(null);
      const [hoursWorked, setHoursWorked] = useState(7.5); // Mock data

      useEffect(() => {
        let watchId;
        
        if (locationSharing && navigator.geolocation) {
          watchId = navigator.geolocation.watchPosition(
            (position) => {
              const loc = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                accuracy: position.coords.accuracy,
                speed: position.coords.speed,
                timestamp: new Date().toISOString()
              };
              setCurrentLocation(loc);
              onLocationUpdate(driver.id, loc);
              setError(null);
            },
            (err) => {
              setError(err.message);
              setLocationSharing(false);
              onLocationStop(driver.id);
            },
            { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
          );
        }

        return () => {
          if (watchId) navigator.geolocation.clearWatch(watchId);
        };
      }, [locationSharing]);

      const toggleLocation = () => {
        if (!navigator.geolocation) {
          setError('Geolocation not supported');
          return;
        }
        
        if (locationSharing) {
          onLocationStop(driver.id);
          setLocationSharing(false);
        } else {
          setLocationSharing(true);
        }
      };

      const hoursRemaining = 11 - hoursWorked;
      const needsBreak = hoursWorked >= 8;

      const pendingTasks = tasks?.filter(t => t.status === 'PENDING').length || 0;
      const todaySchedule = schedule?.filter(s => {
        const schedDate = new Date(s.date).toDateString();
        const today = new Date().toDateString();
        return schedDate === today;
      }).length || 0;

      return (
        <div>
          <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem'}}>
            <h1 style={{fontSize: '2rem', fontWeight: 900}}>
              Welcome, {driver.name.split(' ')[0]}!
            </h1>
            
            {/* Emergency SOS Button */}
            <button 
              className="btn btn-danger"
              onClick={onSOS}
              style={{fontSize: '1rem', padding: '1rem 2rem', fontWeight: 700}}
            >
              üö® EMERGENCY SOS
            </button>
          </div>

          {/* Hours of Service Tracker */}
          <div className="card" style={{background: needsBreak ? 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)' : 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)', border: needsBreak ? '2px solid var(--danger)' : '2px solid var(--primary)', marginBottom: '1.5rem'}}>
            <h3 style={{fontSize: '1.25rem', fontWeight: 700, marginBottom: '1rem'}}>
              ‚è∞ Hours of Service Status
            </h3>
            <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '1.5rem'}}>
              <div>
                <div style={{fontSize: '2rem', fontWeight: 900, color: 'var(--primary)'}}>
                  {hoursWorked}h
                </div>
                <div style={{fontSize: '0.875rem', fontWeight: 600, color: 'var(--text-muted)'}}>
                  HOURS WORKED TODAY
                </div>
              </div>
              <div>
                <div style={{fontSize: '2rem', fontWeight: 900, color: hoursRemaining < 2 ? 'var(--danger)' : 'var(--success)'}}>
                  {hoursRemaining}h
                </div>
                <div style={{fontSize: '0.875rem', fontWeight: 600, color: 'var(--text-muted)'}}>
                  HOURS REMAINING
                </div>
              </div>
              <div>
                <div style={{fontSize: '2rem', fontWeight: 900, color: needsBreak ? 'var(--danger)' : 'var(--success)'}}>
                  {needsBreak ? 'REQUIRED' : 'NOT YET'}
                </div>
                <div style={{fontSize: '0.875rem', fontWeight: 600, color: 'var(--text-muted)'}}>
                  30-MIN BREAK
                </div>
              </div>
            </div>
            {needsBreak && (
              <div style={{marginTop: '1rem', padding: '1rem', background: 'rgba(239, 68, 68, 0.1)', borderRadius: '8px', color: '#991b1b', fontWeight: 600}}>
                ‚ö†Ô∏è You must take a 30-minute break before continuing to drive
              </div>
            )}
            <div style={{marginTop: '1rem', fontSize: '0.875rem', color: 'var(--text-muted)'}}>
              Estimate only ‚Äî not an official ELD record. Always follow your ELD for compliance.
            </div>
          </div>

          {/* Quick Actions */}
          <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem', marginBottom: '2rem'}}>
            <button 
              className="btn btn-primary"
              onClick={() => onViewChange('nearby')}
              style={{padding: '1rem', fontSize: '1rem'}}
            >
              ‚õΩ Find Fuel Stops
            </button>
            <button 
              className="btn btn-primary"
              onClick={() => onViewChange('nearby')}
              style={{padding: '1rem', fontSize: '1rem'}}
            >
              üçî Find Food
            </button>
            <button 
              className="btn btn-primary"
              onClick={() => onViewChange('schedule')}
              style={{padding: '1rem', fontSize: '1rem'}}
            >
              üìÖ View Schedule
            </button>
            <button 
              className="btn btn-primary"
              onClick={() => onViewChange('loads')}
              style={{padding: '1rem', fontSize: '1rem'}}
            >
              üì¶ My Loads
            </button>
          </div>

          {/* Location Sharing */}
          <div className={locationSharing ? 'card location-card' : 'card location-card off'}>
            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'start'}}>
              <div style={{flex: 1}}>
                <h3 style={{fontSize: '1.25rem', fontWeight: 700, marginBottom: '0.5rem'}}>
                  üìç Location Sharing: {locationSharing ? 'ON' : 'OFF'}
                </h3>
                <p style={{fontSize: '0.95rem', marginBottom: '1rem', color: locationSharing ? '#065f46' : 'var(--text-muted)'}}>
                  {locationSharing 
                    ? 'Admin can see your location. You control this - turn OFF anytime.'
                    : 'Location sharing is OFF. Admin cannot see your location.'}
                </p>
                
                {currentLocation && locationSharing && (
                  <div style={{padding: '1rem', background: 'rgba(255,255,255,0.6)', borderRadius: '8px', fontSize: '0.875rem'}}>
                    <strong>Live Location:</strong>
                    <div>Lat: {currentLocation.lat.toFixed(6)}, Lng: {currentLocation.lng.toFixed(6)}</div>
                    <div>Last update: {new Date(currentLocation.timestamp).toLocaleTimeString()}</div>
                  </div>
                )}
                
                {error && (
                  <div className="alert alert-danger" style={{marginTop: '1rem'}}>
                    <span>‚ö†</span>
                    <div><strong>Error:</strong> {error}</div>
                  </div>
                )}
              </div>
              
              <button 
                className={`btn ${locationSharing ? 'btn-danger' : 'btn-success'}`}
                onClick={toggleLocation}
                style={{padding: '1rem 2rem'}}
              >
                {locationSharing ? 'üõë Stop Sharing' : 'üìç Start Sharing'}
              </button>
            </div>
          </div>

          {/* Stats */}
          <div className="stats-grid">
            <div className="stat-card">
              <div className="stat-value">{loads.length}</div>
              <div className="stat-label">Active Loads</div>
            </div>
            <div className="stat-card">
              <div className="stat-value" style={{color: 'var(--warning)'}}>{pendingTasks}</div>
              <div className="stat-label">Pending Tasks</div>
            </div>
            <div className="stat-card">
              <div className="stat-value">{todaySchedule}</div>
              <div className="stat-label">Today's Schedule</div>
            </div>
            <div className="stat-card">
              <div className="stat-value">1,260</div>
              <div className="stat-label">Total Miles</div>
            </div>
          </div>

          {/* Active Load */}
          {loads.filter(l => l.status === 'ASSIGNED').length > 0 && (
            <div className="card" style={{background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)', border: '2px solid var(--warning)'}}>
              <h3 style={{fontSize: '1.25rem', fontWeight: 700, marginBottom: '1rem'}}>
                üöö Active Load: {loads[0].loadNumber}
              </h3>
              <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1.5rem'}}>
                <div>
                  <strong>üìç Pickup:</strong> {loads[0].pickupLocation}
                  <div style={{fontSize: '0.875rem', color: 'var(--text-muted)'}}>{loads[0].pickupAddress}</div>
                </div>
                <div>
                  <strong>üéØ Delivery:</strong> {loads[0].deliveryLocation}
                  <div style={{fontSize: '0.875rem', color: 'var(--text-muted)'}}>{loads[0].deliveryAddress}</div>
                </div>
              </div>
              <button 
                className="btn btn-success"
                onClick={() => window.open(`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(loads[0].pickupAddress)}&destination=${encodeURIComponent(loads[0].deliveryAddress)}&travelmode=driving`, '_blank')}
                style={{marginTop: '1rem'}}
              >
                üó∫Ô∏è Navigate Now
              </button>
            </div>
          )}
        </div>
      );
    }

    function AdminDashboard({ drivers, loads }) {
      const sharingLocation = drivers.filter(d => d.locationSharing).length;
      
      return (
        <div>
          <h1 style={{marginBottom: '2rem', fontSize: '2rem', fontWeight: 900}}>Admin Dashboard</h1>
          
          <div className="stats-grid">
            <div className="stat-card">
              <div className="stat-value">{drivers.length}</div>
              <div className="stat-label">Total Drivers</div>
            </div>
            <div className="stat-card">
              <div className="stat-value">{drivers.filter(d => d.status === 'ACTIVE').length}</div>
              <div className="stat-label">Active Drivers</div>
            </div>
            <div className="stat-card">
              <div className="stat-value">{sharingLocation}</div>
              <div className="stat-label">Sharing Location</div>
            </div>
            <div className="stat-card">
              <div className="stat-value">{loads.length}</div>
              <div className="stat-label">Active Loads</div>
            </div>
          </div>

          <div className="alert alert-success">
            <span>‚úÖ</span>
            <div>
              <strong>System Status: Online</strong>
              <div style={{fontSize: '0.875rem', marginTop: '0.25rem'}}>
                All systems operational. {sharingLocation} drivers sharing location. Click "Live Tracking" to view map.
              </div>
            </div>
          </div>
        </div>
      );
    }

    function InboxView({ user, messages, onSend, loads }) {
      const [selectedThread, setSelectedThread] = useState('general');
      const [newMessage, setNewMessage] = useState('');

      const threads = [
        { id: 'general', name: user.role === 'DRIVER' ? 'Dispatch' : 'General Messages', type: 'general' },
        ...loads.map(load => ({
          id: `load-${load.id}`,
          name: `Load ${load.loadNumber}`,
          type: 'load',
          load
        }))
      ];

      const threadMessages = messages.filter(m => 
        m.threadId === selectedThread
      );

      const handleSend = () => {
        if (!newMessage.trim()) return;
        
        onSend({
          threadId: selectedThread,
          content: newMessage,
          sender: user.role,
          senderName: user.name
        });
        setNewMessage('');
      };

      return (
        <div>
          <h1 style={{marginBottom: '2rem', fontSize: '2rem', fontWeight: 900}}>Inbox</h1>

          <div style={{display: 'grid', gridTemplateColumns: '300px 1fr', gap: '1.5rem'}}>
            {/* Thread List */}
            <div className="card">
              <h3 style={{fontWeight: 700, marginBottom: '1rem'}}>Conversations</h3>
              {threads.map(thread => (
                <div
                  key={thread.id}
                  onClick={() => setSelectedThread(thread.id)}
                  style={{
                    padding: '1rem',
                    marginBottom: '0.5rem',
                    background: selectedThread === thread.id ? 'var(--primary-light)' : 'var(--bg)',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    fontWeight: selectedThread === thread.id ? 700 : 400,
                    color: selectedThread === thread.id ? 'var(--primary)' : 'var(--text)'
                  }}
                >
                  {thread.type === 'general' ? 'üí¨' : 'üì¶'} {thread.name}
                </div>
              ))}
            </div>

            {/* Messages */}
            <div className="card">
              <h3 style={{fontWeight: 700, marginBottom: '1rem'}}>
                {threads.find(t => t.id === selectedThread)?.name}
              </h3>

              <div className="message-list">
                {threadMessages.length === 0 ? (
                  <div style={{textAlign: 'center', padding: '3rem', color: 'var(--text-muted)'}}>
                    <div style={{fontSize: '3rem', marginBottom: '1rem'}}>üí¨</div>
                    <div>No messages yet</div>
                    <div style={{fontSize: '0.875rem'}}>Start a conversation with dispatch</div>
                  </div>
                ) : (
                  threadMessages.map(msg => (
                    <div key={msg.id} className={`message ${msg.sender === user.role ? 'sent' : 'received'}`}>
                      <div className="message-avatar">
                        {msg.senderName[0]}
                      </div>
                      <div>
                        <div className="message-bubble">
                          <div style={{fontWeight: 600, marginBottom: '0.25rem', fontSize: '0.875rem'}}>
                            {msg.senderName}
                          </div>
                          <div>{msg.content}</div>
                        </div>
                        <div className="message-time">
                          {new Date(msg.timestamp).toLocaleString()}
                        </div>
                      </div>
                    </div>
                  ))
                )}
              </div>

              <div style={{display: 'flex', gap: '0.5rem'}}>
                <input
                  className="form-input"
                  placeholder="Type your message..."
                  value={newMessage}
                  onChange={e => setNewMessage(e.target.value)}
                  onKeyPress={e => e.key === 'Enter' && handleSend()}
                  style={{flex: 1, marginBottom: 0}}
                />
                <button className="btn btn-primary" onClick={handleSend}>
                  Send
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function LiveTracking({ drivers }) {
      const mapRef = useRef(null);
      const [map, setMap] = useState(null);

      useEffect(() => {
        if (!mapRef.current || map) return;

        const leafletMap = L.map(mapRef.current).setView([39.8283, -98.5795], 4);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(leafletMap);
        setMap(leafletMap);
      }, []);

      useEffect(() => {
        if (!map) return;

        map.eachLayer(layer => {
          if (layer instanceof L.Marker) layer.remove();
        });

        drivers.forEach(driver => {
          if (driver.lastLocation) {
            L.marker([driver.lastLocation.lat, driver.lastLocation.lng])
              .addTo(map)
              .bindPopup(`<strong>${driver.name}</strong><br/>${driver.truckNumber}<br/>Status: ${driver.status}`);
          }
        });

        if (drivers.length > 0 && drivers[0].lastLocation) {
          const bounds = drivers.filter(d => d.lastLocation).map(d => [d.lastLocation.lat, d.lastLocation.lng]);
          if (bounds.length > 0) {
            map.fitBounds(bounds, { padding: [50, 50] });
          }
        }
      }, [map, drivers]);

      return (
        <div>
          <h1 style={{marginBottom: '2rem', fontSize: '2rem', fontWeight: 900}}>Live Driver Tracking</h1>
          
          <div className="alert alert-success">
            <span>üìç</span>
            <div>
              <strong>{drivers.length} Drivers Sharing Location</strong>
              <div style={{fontSize: '0.875rem'}}>Real-time updates every 30 seconds</div>
            </div>
          </div>

          {drivers.length === 0 ? (
            <div className="card" style={{textAlign: 'center', padding: '3rem'}}>
              <div style={{fontSize: '3rem', marginBottom: '1rem'}}>üìç</div>
              <h3 style={{marginBottom: '0.5rem'}}>No Drivers Sharing Location</h3>
              <p style={{color: 'var(--text-muted)'}}>Drivers must enable location sharing from their dashboard</p>
            </div>
          ) : (
            <div ref={mapRef} className="map-container"></div>
          )}
        </div>
      );
    }

    function DocumentsView({ user, loads, onUpload }) {
      return (
        <div>
          <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '2rem'}}>
            <h1 style={{fontSize: '2rem', fontWeight: 900}}>Documents</h1>
            {user.role === 'DRIVER' && (
              <button className="btn btn-primary" onClick={onUpload}>
                üì§ Upload Document
              </button>
            )}
          </div>

          <div className="card" style={{textAlign: 'center', padding: '3rem'}}>
            <div style={{fontSize: '3rem', marginBottom: '1rem'}}>üìÑ</div>
            <h3 style={{marginBottom: '0.5rem'}}>No Documents Yet</h3>
            <p style={{color: 'var(--text-muted)'}}>Upload your first document to get started</p>
          </div>
        </div>
      );
    }

    function LoadsView({ loads, isAdmin }) {
      return (
        <div>
          <h1 style={{marginBottom: '2rem', fontSize: '2rem', fontWeight: 900}}>
            {isAdmin ? 'All Loads' : 'My Loads'}
          </h1>

          <div className="card">
            <table className="table">
              <thead>
                <tr>
                  <th>Load #</th>
                  <th>Route</th>
                  <th>Distance</th>
                  <th>Pay</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {loads.map(load => (
                  <tr key={load.id}>
                    <td><strong>{load.loadNumber}</strong></td>
                    <td>{load.pickupLocation} ‚Üí {load.deliveryLocation}</td>
                    <td>{load.distance} mi</td>
                    <td style={{color: 'var(--success)', fontWeight: 700}}>${load.estimatedPay}</td>
                    <td><span className={`badge badge-${load.status.toLowerCase()}`}>{load.status}</span></td>
                    <td>
                      <button 
                        className="btn btn-outline"
                        onClick={() => window.open(`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(load.pickupAddress)}&destination=${encodeURIComponent(load.deliveryAddress)}&travelmode=driving`, '_blank')}
                        style={{padding: '0.5rem 1rem', fontSize: '0.875rem'}}
                      >
                        Navigate
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    function UploadDocumentModal({ loads, onClose, onUpload }) {
      const [selectedLoad, setSelectedLoad] = useState('');
      const [docType, setDocType] = useState('POD');
      const [file, setFile] = useState(null);
      const [validation, setValidation] = useState(null);

      const handleFileChange = (e) => {
        const f = e.target.files[0];
        if (f) {
          setFile(f);
          const result = TruckMateAI.validateDocument(f, docType);
          setValidation(result);
        }
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        if (validation?.isValid) {
          onUpload();
        }
      };

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={e => e.stopPropagation()}>
            <div className="modal-header">
              <h3 className="modal-title">Upload Document</h3>
              <button className="modal-close" onClick={onClose}>√ó</button>
            </div>
            
            <form onSubmit={handleSubmit}>
              <div className="modal-body">
                <div className="form-group">
                  <label className="form-label">Select Load</label>
                  <select className="form-select" required value={selectedLoad} onChange={e => setSelectedLoad(e.target.value)}>
                    <option value="">Choose load...</option>
                    {loads.map(load => (
                      <option key={load.id} value={load.id}>
                        {load.loadNumber} - {load.pickupLocation} ‚Üí {load.deliveryLocation}
                      </option>
                    ))}
                  </select>
                </div>

                <div className="form-group">
                  <label className="form-label">Document Type</label>
                  <select className="form-select" value={docType} onChange={e => setDocType(e.target.value)}>
                    <option value="POD">Proof of Delivery (POD)</option>
                    <option value="BOL">Bill of Lading (BOL)</option>
                    <option value="FUEL_RECEIPT">Fuel Receipt</option>
                    <option value="WEIGHT_TICKET">Weight Ticket</option>
                  </select>
                </div>

                <div className="form-group">
                  <label className="form-label">Upload File</label>
                  <div className="file-upload" onClick={() => document.getElementById('file-input').click()}>
                    {file ? (
                      <div>
                        <div style={{fontSize: '2rem'}}>üìÑ</div>
                        <div style={{fontWeight: 600}}>{file.name}</div>
                      </div>
                    ) : (
                      <div>
                        <div style={{fontSize: '2rem'}}>üì§</div>
                        <div>Click to upload</div>
                      </div>
                    )}
                  </div>
                  <input
                    id="file-input"
                    type="file"
                    accept="image/*,.pdf"
                    onChange={handleFileChange}
                    style={{display: 'none'}}
                  />
                </div>

                {validation && (
                  <div className={`alert ${validation.isValid ? 'alert-success' : 'alert-danger'}`}>
                    <span>{validation.isValid ? '‚úÖ' : 'üö®'}</span>
                    <div>
                      <strong>AI Validation: {validation.confidence}% Confidence</strong>
                      {validation.issues.length > 0 && (
                        <div style={{fontSize: '0.875rem', marginTop: '0.5rem'}}>
                          {validation.issues.map((issue, i) => (
                            <div key={i}>‚Ä¢ {issue.message}</div>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                )}
              </div>

              <div className="modal-footer">
                <button type="button" className="btn btn-outline" onClick={onClose}>Cancel</button>
                <button type="submit" className="btn btn-success" disabled={!validation?.isValid}>
                  Upload Document
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    function DriversView({ drivers, onAddDriver, onViewDriver }) {
      const [search, setSearch] = useState('');
      
      const filtered = drivers.filter(d => 
        d.name.toLowerCase().includes(search.toLowerCase()) ||
        d.email.toLowerCase().includes(search.toLowerCase()) ||
        d.truckNumber.toLowerCase().includes(search.toLowerCase())
      );

      return (
        <div>
          <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem'}}>
            <h1 style={{fontSize: '2rem', fontWeight: 900}}>Drivers ({drivers.length})</h1>
            <button className="btn btn-primary" onClick={onAddDriver}>
              ‚ûï Create Driver Account
            </button>
          </div>

          <div className="card">
            <div style={{marginBottom: '1.5rem'}}>
              <input
                className="form-input"
                placeholder="Search drivers by name, email, or truck number..."
                value={search}
                onChange={e => setSearch(e.target.value)}
              />
            </div>

            <table className="table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Truck #</th>
                  <th>Phone</th>
                  <th>Status</th>
                  <th>Location</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {filtered.slice(0, 50).map(driver => (
                  <tr key={driver.id}>
                    <td><strong>{driver.name}</strong></td>
                    <td>{driver.email}</td>
                    <td>{driver.truckNumber}</td>
                    <td>{driver.phone}</td>
                    <td>
                      <span className={`badge badge-${driver.status.toLowerCase()}`}>
                        {driver.status}
                      </span>
                    </td>
                    <td>
                      {driver.locationSharing ? (
                        <span style={{color: 'var(--success)', fontWeight: 600}}>üìç Sharing</span>
                      ) : (
                        <span style={{color: 'var(--text-muted)'}}>‚ö™ Off</span>
                      )}
                    </td>
                    <td>
                      <button 
                        className="btn btn-outline" 
                        onClick={() => onViewDriver(driver)}
                        style={{padding: '0.5rem 1rem', fontSize: '0.875rem'}}
                      >
                        View
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    function CreateDriverModal({ onClose, onCreate }) {
      const [formData, setFormData] = useState({
        name: '',
        email: '',
        phone: '',
        truckNumber: '',
        tempPassword: Math.random().toString(36).slice(-8),
        status: 'ACTIVE'
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        onCreate(formData);
      };

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={e => e.stopPropagation()}>
            <div className="modal-header">
              <h3 className="modal-title">Create Driver Account</h3>
              <button className="modal-close" onClick={onClose}>√ó</button>
            </div>
            
            <form onSubmit={handleSubmit}>
              <div className="modal-body">
                <div className="alert alert-info">
                  <span>‚ÑπÔ∏è</span>
                  <div>
                    <strong>Creating driver account</strong>
                    <div style={{fontSize: '0.875rem', marginTop: '0.25rem'}}>
                      A temporary password will be generated. Share the login credentials with the driver after creation.
                    </div>
                  </div>
                </div>

                <div className="form-group">
                  <label className="form-label">Full Name *</label>
                  <input
                    className="form-input"
                    required
                    value={formData.name}
                    onChange={e => setFormData({...formData, name: e.target.value})}
                    placeholder="John Smith"
                  />
                </div>

                <div className="form-group">
                  <label className="form-label">Email *</label>
                  <input
                    type="email"
                    className="form-input"
                    required
                    value={formData.email}
                    onChange={e => setFormData({...formData, email: e.target.value})}
                    placeholder="driver@example.com"
                  />
                </div>

                <div className="form-row">
                  <div className="form-group">
                    <label className="form-label">Phone *</label>
                    <input
                      type="tel"
                      className="form-input"
                      required
                      value={formData.phone}
                      onChange={e => setFormData({...formData, phone: e.target.value})}
                      placeholder="+1 (555) 123-4567"
                    />
                  </div>

                  <div className="form-group">
                    <label className="form-label">Truck Number *</label>
                    <input
                      className="form-input"
                      required
                      value={formData.truckNumber}
                      onChange={e => setFormData({...formData, truckNumber: e.target.value})}
                      placeholder="TRK-001"
                    />
                  </div>
                </div>

                <div className="form-group">
                  <label className="form-label">Temporary Password</label>
                  <input
                    className="form-input"
                    readOnly
                    value={formData.tempPassword}
                    style={{background: 'var(--bg)', cursor: 'not-allowed'}}
                  />
                  <div style={{fontSize: '0.875rem', color: 'var(--text-muted)', marginTop: '0.5rem'}}>
                    Auto-generated. Share this with the driver after account creation.
                  </div>
                </div>

                <div className="form-group">
                  <label className="form-label">Initial Status</label>
                  <select 
                    className="form-select"
                    value={formData.status}
                    onChange={e => setFormData({...formData, status: e.target.value})}
                  >
                    <option value="ACTIVE">Active</option>
                    <option value="OFF_DUTY">Off Duty</option>
                  </select>
                </div>
              </div>

              <div className="modal-footer">
                <button type="button" className="btn btn-outline" onClick={onClose}>Cancel</button>
                <button type="submit" className="btn btn-primary">
                  Create Driver Account
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    function TasksView({ tasks, drivers, onCreateTask, onViewTask }) {
      const [filter, setFilter] = useState('ALL');
      
      const filtered = tasks.filter(t => {
        if (filter === 'ALL') return true;
        return t.status === filter;
      });

      const statusCounts = {
        PENDING: tasks.filter(t => t.status === 'PENDING').length,
        IN_PROGRESS: tasks.filter(t => t.status === 'IN_PROGRESS').length,
        COMPLETED: tasks.filter(t => t.status === 'COMPLETED').length
      };

      return (
        <div>
          <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem'}}>
            <h1 style={{fontSize: '2rem', fontWeight: 900}}>Tasks & Assignments</h1>
            <button className="btn btn-primary" onClick={onCreateTask}>
              ‚ûï Assign New Task
            </button>
          </div>

          <div className="stats-grid">
            <div className="stat-card">
              <div className="stat-value">{tasks.length}</div>
              <div className="stat-label">Total Tasks</div>
            </div>
            <div className="stat-card">
              <div className="stat-value" style={{color: 'var(--warning)'}}>{statusCounts.PENDING}</div>
              <div className="stat-label">Pending</div>
            </div>
            <div className="stat-card">
              <div className="stat-value" style={{color: 'var(--primary)'}}>{statusCounts.IN_PROGRESS}</div>
              <div className="stat-label">In Progress</div>
            </div>
            <div className="stat-card">
              <div className="stat-value" style={{color: 'var(--success)'}}>{statusCounts.COMPLETED}</div>
              <div className="stat-label">Completed</div>
            </div>
          </div>

          <div className="card">
            <div style={{marginBottom: '1.5rem', display: 'flex', gap: '0.5rem'}}>
              <button 
                className={`btn ${filter === 'ALL' ? 'btn-primary' : 'btn-outline'}`}
                onClick={() => setFilter('ALL')}
                style={{padding: '0.5rem 1rem'}}
              >
                All ({tasks.length})
              </button>
              <button 
                className={`btn ${filter === 'PENDING' ? 'btn-primary' : 'btn-outline'}`}
                onClick={() => setFilter('PENDING')}
                style={{padding: '0.5rem 1rem'}}
              >
                Pending ({statusCounts.PENDING})
              </button>
              <button 
                className={`btn ${filter === 'IN_PROGRESS' ? 'btn-primary' : 'btn-outline'}`}
                onClick={() => setFilter('IN_PROGRESS')}
                style={{padding: '0.5rem 1rem'}}
              >
                In Progress ({statusCounts.IN_PROGRESS})
              </button>
              <button 
                className={`btn ${filter === 'COMPLETED' ? 'btn-primary' : 'btn-outline'}`}
                onClick={() => setFilter('COMPLETED')}
                style={{padding: '0.5rem 1rem'}}
              >
                Completed ({statusCounts.COMPLETED})
              </button>
            </div>

            {filtered.length === 0 ? (
              <div style={{textAlign: 'center', padding: '3rem', color: 'var(--text-muted)'}}>
                <div style={{fontSize: '3rem', marginBottom: '1rem'}}>‚úì</div>
                <h3 style={{marginBottom: '0.5rem'}}>No Tasks Yet</h3>
                <p>Click "Assign New Task" to create your first task</p>
              </div>
            ) : (
              <table className="table">
                <thead>
                  <tr>
                    <th>Task</th>
                    <th>Driver</th>
                    <th>Priority</th>
                    <th>Due Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {filtered.map(task => (
                    <tr key={task.id}>
                      <td>
                        <strong>{task.title}</strong>
                        <div style={{fontSize: '0.875rem', color: 'var(--text-muted)'}}>
                          {task.description?.substring(0, 50)}...
                        </div>
                      </td>
                      <td>{drivers.find(d => d.id === task.driverId)?.name}</td>
                      <td>
                        <span className={`badge badge-${task.priority === 'HIGH' ? 'danger' : task.priority === 'MEDIUM' ? 'pending' : 'active'}`}>
                          {task.priority}
                        </span>
                      </td>
                      <td>{task.dueDate ? new Date(task.dueDate).toLocaleDateString() : 'No deadline'}</td>
                      <td>
                        <span className={`badge badge-${task.status === 'COMPLETED' ? 'approved' : task.status === 'IN_PROGRESS' ? 'assigned' : 'pending'}`}>
                          {task.status.replace('_', ' ')}
                        </span>
                      </td>
                      <td>
                        <button 
                          className="btn btn-outline" 
                          onClick={() => onViewTask(task)}
                          style={{padding: '0.5rem 1rem', fontSize: '0.875rem'}}
                        >
                          View
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            )}
          </div>
        </div>
      );
    }

    function DriverTasksView({ tasks, onUpdateStatus }) {
      const pendingTasks = tasks.filter(t => t.status === 'PENDING');
      const inProgressTasks = tasks.filter(t => t.status === 'IN_PROGRESS');
      const completedTasks = tasks.filter(t => t.status === 'COMPLETED');

      const TaskCard = ({ task }) => (
        <div className="card" style={{marginBottom: '1rem'}}>
          <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'start'}}>
            <div style={{flex: 1}}>
              <h3 style={{fontSize: '1.25rem', fontWeight: 700, marginBottom: '0.5rem'}}>
                {task.title}
              </h3>
              <p style={{color: 'var(--text-muted)', marginBottom: '1rem'}}>
                {task.description}
              </p>
              <div style={{display: 'flex', gap: '1rem', fontSize: '0.875rem'}}>
                <div>
                  <strong>Priority:</strong>{' '}
                  <span className={`badge badge-${task.priority === 'HIGH' ? 'danger' : task.priority === 'MEDIUM' ? 'pending' : 'active'}`}>
                    {task.priority}
                  </span>
                </div>
                {task.dueDate && (
                  <div>
                    <strong>Due:</strong> {new Date(task.dueDate).toLocaleDateString()}
                  </div>
                )}
                {task.loadId && (
                  <div>
                    <strong>Load:</strong> {task.loadId}
                  </div>
                )}
              </div>
            </div>
            <div style={{display: 'flex', flexDirection: 'column', gap: '0.5rem'}}>
              {task.status === 'PENDING' && (
                <button 
                  className="btn btn-primary"
                  onClick={() => onUpdateStatus(task.id, 'IN_PROGRESS')}
                  style={{padding: '0.5rem 1rem', fontSize: '0.875rem'}}
                >
                  Start Task
                </button>
              )}
              {task.status === 'IN_PROGRESS' && (
                <button 
                  className="btn btn-success"
                  onClick={() => onUpdateStatus(task.id, 'COMPLETED')}
                  style={{padding: '0.5rem 1rem', fontSize: '0.875rem'}}
                >
                  Mark Complete
                </button>
              )}
            </div>
          </div>
        </div>
      );

      return (
        <div>
          <h1 style={{marginBottom: '2rem', fontSize: '2rem', fontWeight: 900}}>My Tasks</h1>

          <div className="stats-grid">
            <div className="stat-card">
              <div className="stat-value" style={{color: 'var(--warning)'}}>{pendingTasks.length}</div>
              <div className="stat-label">Pending</div>
            </div>
            <div className="stat-card">
              <div className="stat-value" style={{color: 'var(--primary)'}}>{inProgressTasks.length}</div>
              <div className="stat-label">In Progress</div>
            </div>
            <div className="stat-card">
              <div className="stat-value" style={{color: 'var(--success)'}}>{completedTasks.length}</div>
              <div className="stat-label">Completed</div>
            </div>
            <div className="stat-card">
              <div className="stat-value">{tasks.length}</div>
              <div className="stat-label">Total Tasks</div>
            </div>
          </div>

          {tasks.length === 0 ? (
            <div className="card" style={{textAlign: 'center', padding: '3rem'}}>
              <div style={{fontSize: '3rem', marginBottom: '1rem'}}>‚úì</div>
              <h3 style={{marginBottom: '0.5rem'}}>No Tasks Assigned</h3>
              <p style={{color: 'var(--text-muted)'}}>Your admin will assign tasks to you</p>
            </div>
          ) : (
            <>
              {pendingTasks.length > 0 && (
                <>
                  <h2 style={{fontSize: '1.5rem', fontWeight: 700, marginBottom: '1rem'}}>
                    ‚è≥ Pending Tasks
                  </h2>
                  {pendingTasks.map(task => <TaskCard key={task.id} task={task} />)}
                </>
              )}

              {inProgressTasks.length > 0 && (
                <>
                  <h2 style={{fontSize: '1.5rem', fontWeight: 700, marginBottom: '1rem', marginTop: '2rem'}}>
                    üîÑ In Progress
                  </h2>
                  {inProgressTasks.map(task => <TaskCard key={task.id} task={task} />)}
                </>
              )}

              {completedTasks.length > 0 && (
                <>
                  <h2 style={{fontSize: '1.5rem', fontWeight: 700, marginBottom: '1rem', marginTop: '2rem'}}>
                    ‚úÖ Completed
                  </h2>
                  {completedTasks.map(task => <TaskCard key={task.id} task={task} />)}
                </>
              )}
            </>
          )}
        </div>
      );
    }

    function DriverScheduleView({ schedule, driver }) {
      const today = new Date();
      const upcoming = schedule.filter(s => new Date(s.date) >= today).sort((a, b) => new Date(a.date) - new Date(b.date));
      const past = schedule.filter(s => new Date(s.date) < today).sort((a, b) => new Date(b.date) - new Date(a.date));

      return (
        <div>
          <h1 style={{marginBottom: '2rem', fontSize: '2rem', fontWeight: 900}}>My Schedule</h1>

          <div className="alert alert-info">
            <span>üìÖ</span>
            <div>
              <strong>Your Upcoming Schedule</strong>
              <div style={{fontSize: '0.875rem', marginTop: '0.25rem'}}>
                All scheduled loads, tasks, and appointments appear here
              </div>
            </div>
          </div>

          {upcoming.length === 0 && past.length === 0 ? (
            <div className="card" style={{textAlign: 'center', padding: '3rem'}}>
              <div style={{fontSize: '3rem', marginBottom: '1rem'}}>üìÖ</div>
              <h3 style={{marginBottom: '0.5rem'}}>No Schedule Yet</h3>
              <p style={{color: 'var(--text-muted)'}}>Your admin will schedule loads and tasks for you</p>
            </div>
          ) : (
            <>
              {upcoming.length > 0 && (
                <>
                  <h2 style={{fontSize: '1.5rem', fontWeight: 700, marginBottom: '1rem'}}>
                    üìç Upcoming ({upcoming.length})
                  </h2>
                  <div className="card">
                    <table className="table">
                      <thead>
                        <tr>
                          <th>Date</th>
                          <th>Time</th>
                          <th>Type</th>
                          <th>Details</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        {upcoming.map((item, i) => (
                          <tr key={i}>
                            <td><strong>{new Date(item.date).toLocaleDateString()}</strong></td>
                            <td>{item.time || 'All day'}</td>
                            <td><span className="badge badge-assigned">{item.type}</span></td>
                            <td>{item.details}</td>
                            <td><span className="badge badge-pending">Scheduled</span></td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </>
              )}

              {past.length > 0 && (
                <>
                  <h2 style={{fontSize: '1.5rem', fontWeight: 700, marginBottom: '1rem', marginTop: '2rem'}}>
                    ‚úÖ Past Events ({past.length})
                  </h2>
                  <div className="card">
                    <table className="table">
                      <thead>
                        <tr>
                          <th>Date</th>
                          <th>Type</th>
                          <th>Details</th>
                        </tr>
                      </thead>
                      <tbody>
                        {past.slice(0, 10).map((item, i) => (
                          <tr key={i}>
                            <td>{new Date(item.date).toLocaleDateString()}</td>
                            <td><span className="badge badge-active">{item.type}</span></td>
                            <td>{item.details}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </>
              )}
            </>
          )}
        </div>
      );
    }

    function NearbyPlacesView({ driver }) {
      const [searchType, setSearchType] = useState('fuel');
      const [searching, setSearching] = useState(false);

      const handleSearch = (type) => {
        setSearchType(type);
        setSearching(true);
        
        setTimeout(() => {
          setSearching(false);
          const query = type === 'fuel' ? 'truck stop near me' : 'fast food near me';
          window.open(`https://www.google.com/maps/search/${encodeURIComponent(query)}`, '_blank');
        }, 500);
      };

      return (
        <div>
          <h1 style={{marginBottom: '2rem', fontSize: '2rem', fontWeight: 900}}>Find Nearby Places</h1>

          <div className="alert alert-info">
            <span>üìç</span>
            <div>
              <strong>Location-Based Search</strong>
              <div style={{fontSize: '0.875rem', marginTop: '0.25rem'}}>
                Find fuel stops, restaurants, rest areas, and services near your current location
              </div>
            </div>
          </div>

          <div className="stats-grid">
            <div className="card" style={{textAlign: 'center', cursor: 'pointer'}} onClick={() => handleSearch('fuel')}>
              <div style={{fontSize: '4rem', marginBottom: '1rem'}}>‚õΩ</div>
              <h3 style={{fontSize: '1.25rem', fontWeight: 700, marginBottom: '0.5rem'}}>Fuel Stops</h3>
              <p style={{color: 'var(--text-muted)', marginBottom: '1rem'}}>
                Gas stations, truck stops, diesel
              </p>
              <button className="btn btn-primary" style={{width: '100%'}}>
                Find Fuel
              </button>
            </div>

            <div className="card" style={{textAlign: 'center', cursor: 'pointer'}} onClick={() => handleSearch('food')}>
              <div style={{fontSize: '4rem', marginBottom: '1rem'}}>üçî</div>
              <h3 style={{fontSize: '1.25rem', fontWeight: 700, marginBottom: '0.5rem'}}>Food & Restaurants</h3>
              <p style={{color: 'var(--text-muted)', marginBottom: '1rem'}}>
                Fast food, diners, restaurants
              </p>
              <button className="btn btn-primary" style={{width: '100%'}}>
                Find Food
              </button>
            </div>

            <div className="card" style={{textAlign: 'center', cursor: 'pointer'}} onClick={() => window.open('https://www.google.com/maps/search/rest+area+near+me', '_blank')}>
              <div style={{fontSize: '4rem', marginBottom: '1rem'}}>üõèÔ∏è</div>
              <h3 style={{fontSize: '1.25rem', fontWeight: 700, marginBottom: '0.5rem'}}>Rest Areas</h3>
              <p style={{color: 'var(--text-muted)', marginBottom: '1rem'}}>
                Rest stops, truck parking
              </p>
              <button className="btn btn-primary" style={{width: '100%'}}>
                Find Rest Area
              </button>
            </div>

            <div className="card" style={{textAlign: 'center', cursor: 'pointer'}} onClick={() => window.open('https://www.google.com/maps/search/truck+service+near+me', '_blank')}>
              <div style={{fontSize: '4rem', marginBottom: '1rem'}}>üîß</div>
              <h3 style={{fontSize: '1.25rem', fontWeight: 700, marginBottom: '0.5rem'}}>Service Centers</h3>
              <p style={{color: 'var(--text-muted)', marginBottom: '1rem'}}>
                Truck repair, maintenance
              </p>
              <button className="btn btn-primary" style={{width: '100%'}}>
                Find Service
              </button>
            </div>
          </div>

          <div className="card">
            <h3 style={{fontSize: '1.25rem', fontWeight: 700, marginBottom: '1rem'}}>üö® Emergency Contacts</h3>
            <div style={{display: 'grid', gap: '1rem'}}>
              <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '1rem', background: 'var(--bg)', borderRadius: '8px'}}>
                <div>
                  <div style={{fontWeight: 700}}>Emergency Services</div>
                  <div style={{fontSize: '0.875rem', color: 'var(--text-muted)'}}>Police, Fire, Ambulance</div>
                </div>
                <a href="tel:911" className="btn btn-danger">Call 911</a>
              </div>
              <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '1rem', background: 'var(--bg)', borderRadius: '8px'}}>
                <div>
                  <div style={{fontWeight: 700}}>Roadside Assistance</div>
                  <div style={{fontSize: '0.875rem', color: 'var(--text-muted)'}}>Towing, tire service, fuel delivery</div>
                </div>
                <a href="tel:1-800-AAA-HELP" className="btn btn-primary">Call AAA</a>
              </div>
              <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '1rem', background: 'var(--bg)', borderRadius: '8px'}}>
                <div>
                  <div style={{fontWeight: 700}}>Dispatch</div>
                  <div style={{fontSize: '0.875rem', color: 'var(--text-muted)'}}>Your company dispatch</div>
                </div>
                <a href="tel:1-555-DISPATCH" className="btn btn-primary">Call Dispatch</a>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function DriverProfileView({ driver, onUpdate }) {
      const [editing, setEditing] = useState(false);
      const [formData, setFormData] = useState({
        phone: driver.phone,
        emergencyContact: driver.emergencyContact?.name || '',
        emergencyPhone: driver.emergencyContact?.phone || '',
        profilePicture: driver.profilePicture || null
      });

      const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => {
            setFormData({...formData, profilePicture: reader.result});
          };
          reader.readAsDataURL(file);
        }
      };

      const handleSave = () => {
        onUpdate({
          phone: formData.phone,
          emergencyContact: {
            name: formData.emergencyContact,
            phone: formData.emergencyPhone,
            relationship: 'Emergency Contact'
          },
          profilePicture: formData.profilePicture
        });
        setEditing(false);
      };

      return (
        <div>
          <h1 style={{marginBottom: '2rem', fontSize: '2rem', fontWeight: 900}}>My Profile</h1>

          <div className="card">
            <div style={{display: 'flex', gap: '2rem', alignItems: 'start'}}>
              {/* Profile Picture */}
              <div style={{textAlign: 'center'}}>
                <div style={{
                  width: 150,
                  height: 150,
                  borderRadius: '50%',
                  background: formData.profilePicture ? `url(${formData.profilePicture}) center/cover` : 'linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  fontSize: '3rem',
                  color: 'white',
                  fontWeight: 900,
                  marginBottom: '1rem',
                  border: '4px solid white',
                  boxShadow: '0 4px 12px rgba(0,0,0,0.1)'
                }}>
                  {!formData.profilePicture && driver.name[0]}
                </div>
                {editing && (
                  <>
                    <input
                      type="file"
                      accept="image/*"
                      onChange={handleImageUpload}
                      style={{display: 'none'}}
                      id="profile-pic-upload"
                    />
                    <label htmlFor="profile-pic-upload" className="btn btn-outline" style={{cursor: 'pointer'}}>
                      Change Photo
                    </label>
                  </>
                )}
              </div>

              {/* Profile Info */}
              <div style={{flex: 1}}>
                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem'}}>
                  <div>
                    <h2 style={{fontSize: '1.75rem', fontWeight: 900, marginBottom: '0.25rem'}}>{driver.name}</h2>
                    <div style={{color: 'var(--text-muted)'}}>{driver.email}</div>
                  </div>
                  {!editing ? (
                    <button className="btn btn-primary" onClick={() => setEditing(true)}>
                      Edit Profile
                    </button>
                  ) : (
                    <div style={{display: 'flex', gap: '0.5rem'}}>
                      <button className="btn btn-outline" onClick={() => setEditing(false)}>Cancel</button>
                      <button className="btn btn-success" onClick={handleSave}>Save Changes</button>
                    </div>
                  )}
                </div>

                <div className="stats-grid" style={{marginBottom: '2rem'}}>
                  <div>
                    <div className="stat-label">Truck Number</div>
                    <div style={{fontWeight: 700, fontSize: '1.25rem', marginTop: '0.5rem'}}>{driver.truckNumber}</div>
                  </div>
                  <div>
                    <div className="stat-label">CDL Class</div>
                    <div style={{fontWeight: 700, fontSize: '1.25rem', marginTop: '0.5rem'}}>{driver.cdlClass || 'Class A'}</div>
                  </div>
                  <div>
                    <div className="stat-label">Status</div>
                    <div style={{marginTop: '0.5rem'}}>
                      <span className={`badge badge-${driver.status.toLowerCase()}`}>{driver.status}</span>
                    </div>
                  </div>
                  <div>
                    <div className="stat-label">Total Miles</div>
                    <div style={{fontWeight: 700, fontSize: '1.25rem', marginTop: '0.5rem'}}>
                      {(driver.totalMiles || 50000).toLocaleString()}
                    </div>
                  </div>
                </div>

                <div className="form-row">
                  <div className="form-group">
                    <label className="form-label">Phone Number</label>
                    <input
                      className="form-input"
                      value={formData.phone}
                      onChange={e => setFormData({...formData, phone: e.target.value})}
                      disabled={!editing}
                      style={{background: editing ? 'white' : 'var(--bg)'}}
                    />
                  </div>
                  <div className="form-group">
                    <label className="form-label">License Number</label>
                    <input
                      className="form-input"
                      value={driver.licenseNumber}
                      disabled
                      style={{background: 'var(--bg)', cursor: 'not-allowed'}}
                    />
                  </div>
                </div>

                <h3 style={{fontSize: '1.25rem', fontWeight: 700, marginTop: '2rem', marginBottom: '1rem'}}>
                  Emergency Contact
                </h3>
                <div className="form-row">
                  <div className="form-group">
                    <label className="form-label">Contact Name</label>
                    <input
                      className="form-input"
                      value={formData.emergencyContact}
                      onChange={e => setFormData({...formData, emergencyContact: e.target.value})}
                      disabled={!editing}
                      style={{background: editing ? 'white' : 'var(--bg)'}}
                      placeholder="Emergency contact name"
                    />
                  </div>
                  <div className="form-group">
                    <label className="form-label">Contact Phone</label>
                    <input
                      className="form-input"
                      value={formData.emergencyPhone}
                      onChange={e => setFormData({...formData, emergencyPhone: e.target.value})}
                      disabled={!editing}
                      style={{background: editing ? 'white' : 'var(--bg)'}}
                      placeholder="Emergency contact phone"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function CreateTaskModal({ drivers, loads, onClose, onCreate }) {
      const [formData, setFormData] = useState({
        driverId: '',
        title: '',
        description: '',
        priority: 'MEDIUM',
        dueDate: '',
        loadId: '',
        type: 'GENERAL'
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        onCreate(formData);
      };

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={e => e.stopPropagation()}>
            <div className="modal-header">
              <h3 className="modal-title">Assign New Task</h3>
              <button className="modal-close" onClick={onClose}>√ó</button>
            </div>
            
            <form onSubmit={handleSubmit}>
              <div className="modal-body">
                <div className="form-group">
                  <label className="form-label">Assign To Driver *</label>
                  <select 
                    className="form-select" 
                    required 
                    value={formData.driverId}
                    onChange={e => setFormData({...formData, driverId: e.target.value})}
                  >
                    <option value="">Select driver...</option>
                    {drivers.filter(d => d.status === 'ACTIVE').slice(0, 50).map(driver => (
                      <option key={driver.id} value={driver.id}>
                        {driver.name} - {driver.truckNumber}
                      </option>
                    ))}
                  </select>
                </div>

                <div className="form-group">
                  <label className="form-label">Task Type</label>
                  <select 
                    className="form-select"
                    value={formData.type}
                    onChange={e => setFormData({...formData, type: e.target.value})}
                  >
                    <option value="GENERAL">General Task</option>
                    <option value="LOAD_RELATED">Load Related</option>
                    <option value="MAINTENANCE">Maintenance</option>
                    <option value="INSPECTION">Inspection</option>
                    <option value="DOCUMENTATION">Documentation</option>
                  </select>
                </div>

                {formData.type === 'LOAD_RELATED' && (
                  <div className="form-group">
                    <label className="form-label">Related Load</label>
                    <select 
                      className="form-select"
                      value={formData.loadId}
                      onChange={e => setFormData({...formData, loadId: e.target.value})}
                    >
                      <option value="">Select load (optional)...</option>
                      {loads.map(load => (
                        <option key={load.id} value={load.loadNumber}>
                          {load.loadNumber} - {load.pickupLocation} ‚Üí {load.deliveryLocation}
                        </option>
                      ))}
                    </select>
                  </div>
                )}

                <div className="form-group">
                  <label className="form-label">Task Title *</label>
                  <input
                    className="form-input"
                    required
                    value={formData.title}
                    onChange={e => setFormData({...formData, title: e.target.value})}
                    placeholder="e.g., Inspect trailer before loading"
                  />
                </div>

                <div className="form-group">
                  <label className="form-label">Description *</label>
                  <textarea
                    className="form-input"
                    required
                    value={formData.description}
                    onChange={e => setFormData({...formData, description: e.target.value})}
                    placeholder="Provide detailed instructions for the driver..."
                    rows="4"
                    style={{resize: 'vertical'}}
                  />
                </div>

                <div className="form-row">
                  <div className="form-group">
                    <label className="form-label">Priority</label>
                    <select 
                      className="form-select"
                      value={formData.priority}
                      onChange={e => setFormData({...formData, priority: e.target.value})}
                    >
                      <option value="LOW">Low</option>
                      <option value="MEDIUM">Medium</option>
                      <option value="HIGH">High</option>
                    </select>
                  </div>

                  <div className="form-group">
                    <label className="form-label">Due Date</label>
                    <input
                      type="date"
                      className="form-input"
                      value={formData.dueDate}
                      onChange={e => setFormData({...formData, dueDate: e.target.value})}
                    />
                  </div>
                </div>

                <div className="alert alert-info">
                  <span>‚ÑπÔ∏è</span>
                  <div>
                    <strong>Task Notification</strong>
                    <div style={{fontSize: '0.875rem', marginTop: '0.25rem'}}>
                      Driver will be notified immediately and can view task in "My Tasks" section.
                    </div>
                  </div>
                </div>
              </div>

              <div className="modal-footer">
                <button type="button" className="btn btn-outline" onClick={onClose}>Cancel</button>
                <button type="submit" className="btn btn-primary">
                  Assign Task
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    function ViewTaskModal({ task, driver, onClose }) {
      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={e => e.stopPropagation()}>
            <div className="modal-header">
              <h3 className="modal-title">Task Details</h3>
              <button className="modal-close" onClick={onClose}>√ó</button>
            </div>
            
            <div className="modal-body">
              <div style={{marginBottom: '1.5rem'}}>
                <h4 style={{fontSize: '1.5rem', fontWeight: 700, marginBottom: '0.5rem'}}>
                  {task.title}
                </h4>
                <div style={{display: 'flex', gap: '1rem', marginTop: '0.5rem'}}>
                  <span className={`badge badge-${task.status === 'COMPLETED' ? 'approved' : task.status === 'IN_PROGRESS' ? 'assigned' : 'pending'}`}>
                    {task.status.replace('_', ' ')}
                  </span>
                  <span className={`badge badge-${task.priority === 'HIGH' ? 'danger' : task.priority === 'MEDIUM' ? 'pending' : 'active'}`}>
                    {task.priority} PRIORITY
                  </span>
                </div>
              </div>

              <div style={{marginBottom: '1.5rem'}}>
                <strong style={{display: 'block', marginBottom: '0.5rem'}}>Description:</strong>
                <p style={{color: 'var(--text-muted)'}}>{task.description}</p>
              </div>

              <div className="stats-grid">
                <div>
                  <div className="stat-label">Assigned To</div>
                  <div style={{fontWeight: 600, fontSize: '1rem', marginTop: '0.5rem'}}>
                    {driver?.name}
                  </div>
                  <div style={{fontSize: '0.875rem', color: 'var(--text-muted)'}}>
                    {driver?.truckNumber}
                  </div>
                </div>
                <div>
                  <div className="stat-label">Task Type</div>
                  <div style={{fontWeight: 600, fontSize: '1rem', marginTop: '0.5rem'}}>
                    {task.type?.replace('_', ' ')}
                  </div>
                </div>
                <div>
                  <div className="stat-label">Created</div>
                  <div style={{fontWeight: 600, fontSize: '1rem', marginTop: '0.5rem'}}>
                    {new Date(task.createdAt).toLocaleDateString()}
                  </div>
                </div>
                <div>
                  <div className="stat-label">Due Date</div>
                  <div style={{fontWeight: 600, fontSize: '1rem', marginTop: '0.5rem'}}>
                    {task.dueDate ? new Date(task.dueDate).toLocaleDateString() : 'No deadline'}
                  </div>
                </div>
              </div>

              {task.loadId && (
                <div style={{marginTop: '1.5rem'}}>
                  <div className="alert alert-info">
                    <span>üì¶</span>
                    <div>
                      <strong>Related Load:</strong> {task.loadId}
                    </div>
                  </div>
                </div>
              )}
            </div>

            <div className="modal-footer">
              <button className="btn btn-outline" onClick={onClose}>Close</button>
              <button className="btn btn-primary">Send Message to Driver</button>
            </div>
          </div>
        </div>
      );
    }

    function ViewDriverModal({ driver, onClose }) {
      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={e => e.stopPropagation()}>
            <div className="modal-header">
              <h3 className="modal-title">Driver Details</h3>
              <button className="modal-close" onClick={onClose}>√ó</button>
            </div>
            
            <div className="modal-body">
              <div style={{marginBottom: '2rem'}}>
                <h4 style={{fontSize: '1.5rem', fontWeight: 700, marginBottom: '0.5rem'}}>
                  {driver.name}
                </h4>
                <div style={{color: 'var(--text-muted)'}}>{driver.email}</div>
              </div>

              <div className="stats-grid">
                <div>
                  <div className="stat-label">Phone</div>
                  <div style={{fontWeight: 600, fontSize: '1rem', marginTop: '0.5rem'}}>{driver.phone}</div>
                </div>
                <div>
                  <div className="stat-label">Truck Number</div>
                  <div style={{fontWeight: 600, fontSize: '1rem', marginTop: '0.5rem'}}>{driver.truckNumber}</div>
                </div>
                <div>
                  <div className="stat-label">Status</div>
                  <div style={{marginTop: '0.5rem'}}>
                    <span className={`badge badge-${driver.status.toLowerCase()}`}>
                      {driver.status}
                    </span>
                  </div>
                </div>
                <div>
                  <div className="stat-label">Location Sharing</div>
                  <div style={{fontWeight: 600, fontSize: '1rem', marginTop: '0.5rem'}}>
                    {driver.locationSharing ? (
                      <span style={{color: 'var(--success)'}}>üìç ON</span>
                    ) : (
                      <span style={{color: 'var(--text-muted)'}}>‚ö™ OFF</span>
                    )}
                  </div>
                </div>
              </div>

              {driver.lastLocation && driver.locationSharing && (
                <div style={{marginTop: '1.5rem'}}>
                  <div className="alert alert-success">
                    <span>üìç</span>
                    <div>
                      <strong>Last Known Location</strong>
                      <div style={{fontSize: '0.875rem', marginTop: '0.5rem'}}>
                        Lat: {driver.lastLocation.lat.toFixed(6)}, Lng: {driver.lastLocation.lng.toFixed(6)}
                        <br />
                        Last update: {new Date(driver.lastLocation.timestamp).toLocaleString()}
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {!driver.locationSharing && (
                <div style={{marginTop: '1.5rem'}}>
                  <div className="alert alert-info">
                    <span>‚ÑπÔ∏è</span>
                    <div>
                      <strong>Location Sharing Disabled</strong>
                      <div style={{fontSize: '0.875rem', marginTop: '0.25rem'}}>
                        This driver has location sharing turned off. You can request them to enable it via Inbox.
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>

            <div className="modal-footer">
              <button className="btn btn-outline" onClick={onClose}>Close</button>
              <button className="btn btn-primary">Send Message</button>
            </div>
          </div>
        </div>
      );
    }

    function AIAssistant({ user, driver, loads, locationSharing, drivers, onClose }) {
      const [messages, setMessages] = useState([
        { role: 'assistant', content: 'Hi! I am TruckMate AI. How can I help you today?' }
      ]);
      const [input, setInput] = useState('');
      const [isTyping, setIsTyping] = useState(false);

      const handleSend = () => {
        if (!input.trim()) return;
        
        setMessages([...messages, { role: 'user', content: input }]);
        setInput('');
        setIsTyping(true);

        setTimeout(() => {
          const response = TruckMateAI.generateResponse(input, {
            loads,
            trips: [],
            user,
            locationSharing,
            drivers
          });
          
          setMessages(prev => [...prev, { role: 'assistant', content: response }]);
          setIsTyping(false);
        }, 800);
      };

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={e => e.stopPropagation()}>
            <div className="modal-header">
              <h3 className="modal-title">‚ú® TruckMate AI Assistant</h3>
              <button className="modal-close" onClick={onClose}>√ó</button>
            </div>
            
            <div className="modal-body">
              <div className="message-list">
                {messages.map((msg, i) => (
                  <div key={i} className={`message ${msg.role === 'user' ? 'sent' : 'received'}`}>
                    <div className="message-avatar">
                      {msg.role === 'user' ? user.name[0] : '‚ú®'}
                    </div>
                    <div>
                      <div className="message-bubble" style={{whiteSpace: 'pre-wrap'}}>
                        {msg.content}
                      </div>
                    </div>
                  </div>
                ))}
                {isTyping && (
                  <div className="message received">
                    <div className="message-avatar">‚ú®</div>
                    <div className="message-bubble">Typing...</div>
                  </div>
                )}
              </div>

              <div style={{display: 'flex', gap: '0.5rem'}}>
                <input
                  className="form-input"
                  placeholder="Ask me anything..."
                  value={input}
                  onChange={e => setInput(e.target.value)}
                  onKeyPress={e => e.key === 'Enter' && handleSend()}
                  style={{flex: 1, marginBottom: 0}}
                />
                <button className="btn btn-primary" onClick={handleSend}>Send</button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
